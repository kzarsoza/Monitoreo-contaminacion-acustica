¡Claro\! Aquí tienes un prompt consolidado con todas las instrucciones de corrección que hemos discutido, listo para que lo pases a una herramienta CLI.

-----

**Inicio del Prompt para el CLI de Gemini**

**Rol:** Eres un asistente experto en desarrollo frontend con React, TypeScript y Firebase.

**Objetivo:** Voy a proporcionarte el estado de tres archivos de mi proyecto. Tu tarea es aplicar las correcciones necesarias para solucionar problemas de rendimiento, reglas de seguridad y errores 404.

-----

### Tarea 1: Corregir las Reglas de Seguridad de Firebase

Este es mi archivo de reglas actual. Necesita ser actualizado para incluir permisos para la ruta `alert_status`.

**Archivo:** `database.rules.json`

**Contenido a reemplazar:**

```json
{
  "rules": {
    "mediciones": {
      "rules": {
        "mediciones": {
          // Permite a CUALQUIER usuario autenticado (anónimo o no)
          // leer y escribir datos bajo la ruta "mediciones".
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    }
  }
}
```

**Nuevo contenido:**

```json
{
  "rules": {
    "mediciones": {
      // Permite leer y escribir a cualquier usuario autenticado
      ".read": "auth != null",
      ".write": "auth != null"
    },
    "alert_status": {
      // Permite leer y escribir a cualquier usuario autenticado
      // (Necesario para que las Cloud Functions guarden el estado de la alerta)
      ".read": "auth != null",
      ".write": "auth != null"
    }
  }
}
```

-----

### Tarea 2: Optimizar la Consulta de Firebase (Rendimiento)

Mi archivo `firebaseService.ts` descarga la base de datos completa, lo que congela la aplicación. Modifícalo para que solo descargue los últimos 50 registros.

**Archivo:** `services/firebaseService.ts`

**1. Modifica la línea de importación:**

**Busca:**

```typescript
import { getDatabase, ref, onValue, off, DataSnapshot, get, child } from 'firebase/database';
```

**Reemplaza con:**

```typescript
import { getDatabase, ref, onValue, off, DataSnapshot, get, child, query, orderByKey, limitToLast } from 'firebase/database';
```

**2. Modifica la función `listenToRealtimeMeasurements`:**

**Busca este bloque completo:**

```typescript
export const listenToRealtimeMeasurements = (deviceId: string, callback: (data: FirebaseData) => void): (() => void) => {
  const measurementsRef = ref(database, `mediciones/${deviceId}/`);

  const listener = onValue(
    measurementsRef,
    (snapshot: DataSnapshot) => {
      const data = snapshot.val();
      callback(data || {});
    },
    (error) => {
      console.error(`Firebase read failed for device ${deviceId}: `, error);
      callback({});
    }
  );

  // Return an unsubscribe function to be called on component unmount to prevent memory leaks
  return () => {
    off(measurementsRef, 'value', listener);
  };
};
```

**Reemplaza con este nuevo bloque optimizado:**

```typescript
export const listenToRealtimeMeasurements = (deviceId: string, callback: (data: FirebaseData) => void): (() => void) => {
  const baseMeasurementsRef = ref(database, `mediciones/${deviceId}/`);

  // ----- INICIO DE LA CORRECCIÓN -----
  // Creamos una query que ordena por llave (timestamp)
  // y limita la descarga solo a los últimos 50 registros.
  const measurementsQuery = query(baseMeasurementsRef, orderByKey(), limitToLast(50));
  // ----- FIN DE LA CORRECCIÓN -----

  const listener = onValue(
    measurementsQuery, // Usamos la query optimizada
    (snapshot: DataSnapshot) => {
      const data = snapshot.val();
      callback(data || {});
    },
    (error) => {
      console.error(`Firebase read failed for device ${deviceId}: `, error);
      callback({});
    }
  );

  // Devolver la función de desuscripción
  return () => {
    off(measurementsQuery, 'value', listener); // Nos desuscribimos de la query
  };
};
```

-----

### Tarea 3: Corregir Error 404 de CSS

En mi archivo `index.html`, estoy llamando a un archivo CSS que no existe y genera un error 404 en la consola.

**Archivo:** `index.html`

**Instrucción:** Busca y elimina la siguiente línea de este archivo:

```html
<link rel="stylesheet" href="/index.css">
```

-----

### Tarea 4: Comando de Despliegue

Finalmente, después de aplicar todos estos cambios, infórmame que debo ejecutar el siguiente comando en mi terminal para publicar las nuevas reglas de seguridad de Firebase:

```bash
firebase deploy --only database
```

**Fin del Prompt**